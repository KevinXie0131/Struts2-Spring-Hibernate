<script type="text/javascript">
	$(function(){
	
		editRowFlag = undefined;
		//	$.messager.progress({
		//		text:'it is doing...',
		//		interval:100
		//	});
		
		$('#dg').datagrid({
			rowStyler: function(index, row){
				if (row.id > 005) {
					return 'background-color:#6293BB;color:#fff;';
				}
			},
			url: 'PageGrid',
			//	   	title:'ABC',
			pagination: true,
			pageSize: 10,
			pageList: [10, 20, 30, 40],
			iconCls: 'icon-save',
			fit: true,
			fitColumns: false,
			sortName: 'id',
			sortOrder: 'desc',
			columns: [[{
				field: 'id',
				title: 'Id',
				width: 100,
				sortable: true,
				checkbox: false,
				styler: function(value, row, index){
					if (value < 20) {
						return 'background-color:#ffee00;color:red;';
					}
				}
			}, {
				field: 'name',
				title: 'Name',
				width: 100,
				editor: {
					type: 'validatebox',
					options: {
						required: true
					}
				}
			}, {
				field: 'price',
				title: 'Price',
				width: 100,
				align: 'right',
				formatter: function(value, rowData){
					if (value < 500) {
						return '<span style="color:red;">(' + value + ')</span>';
						console.info(rowData);
					}
					else {
						//   return value;
						return '<span title="' + value + '">' + value + '</span>';
					}
				}
			}, {
				field: 'control',
				title: 'Control',
				width: 200,
				align: 'right',
				formatter: function(value, rowData, rowIndex){
					return '<button value="edit" onclick="edit_show(' + rowIndex + ')">Edit</button>' +
					'<button value="delete">Delete</button>' +
					'<a id="btn" href="#" class="easyui-linkbutton">easyui</a>';
				}
			}]],
			toolbar: [{
				text: 'Add',
				iconCls: 'icon-edit',
				handler: function(){
					//	alert('Add')
					/*	$('#dg').datagrid('appendRow',{
				 id: '111',
				 name: 'qqq',
				 price: '22'
				 });
				 */
					//	if(editRowFlag != undefined){
					//		$('#dg').datagrid('endEdit',editRowFlag);
					//	}
					if (editRowFlag == undefined) {
						$('#dg').datagrid('insertRow', {
							index: 1,
							row: {
								id: '111',
								name: 'qqq',
								price: '22'
							}
						});
						$('#dg').datagrid('beginEdit', 1);
						editRowFlag = 1;
					}
				}
			}, '-', {
				text: 'Add2',
				iconCls: 'icon-help',
				handler: function(){
					var length = $('#dg').datagrid('getRows').length;
					$('#dg').datagrid('appendRow', {});
					$('#dg').datagrid('beginEdit', length - 0);
				}
			}, '-', {
				text: 'Update',
				iconCls: 'icon-help',
				handler: function(){
					var selections = $('#dg').datagrid('getSelections');
					//	alert(selections.length);
					if (selections.length == 1) {
						$('#dg').datagrid('beginEdit', $('#dg').datagrid('getRowIndex', selections[0]));
					}
					else {
						$('#dg').datagrid('unselectAll');
						$('#dg').datagrid('beginEdit', $('#dg').datagrid('getRowIndex', selections[0]));
					}
				}
			}, '-', {
				text: 'Delete',
				iconCls: 'icon-help',
				handler: function(){
				
					var selections = $('#dg').datagrid('getSelections');
					if (selections.length > 0) {
						$.messager.confirm('please confirm', 'Delete?', function(b){
							//	alert(b);
							if (b) {
								var ids = [];
								for (var i = 0; i < selections.length; i++) {
									ids.push(selections[i].id);
								}
								alert(ids.join("||"));
								$('#dg').datagrid('deleteRow', $('#dg').datagrid('getRowIndex', selections[0]));
							}
						});
						
					}
					else {
						$.messager.alert('alert', 'no selection', 'error');
					}
				}
			}, '-', {
				text: 'Clear',
				iconCls: 'icon-help',
				handler: function(){
					$('#dg').datagrid('reload', {});
					$("#searchForm").find("[name=name]").val("");
				}
			}, '-', {
				text: 'Redo',
				iconCls: 'icon-help',
				handler: function(){
					$('#dg').datagrid('rejectChanges');
					$('#dg').datagrid('selectAll');
				}
			}, '-', {
				text: 'ClearData',
				iconCls: 'icon-help',
				handler: function(){
					$('#dg').datagrid('loadData', []);
				}
			}, '-', {
				text: 'Ok',
				iconCls: 'icon-help',
				handler: function(){
					$('#dg').datagrid('endEdit', 1);
				}
			}],
			onAfterEdit: function(rowIndex, rowData, changes){
				console.info(rowIndex);
				console.info(rowData);
				//	console.info(changes);
				editRowFlag = undefined;
				
				var inserted = $('#dg').datagrid('getChanges', 'inserted');
				var updated = $('#dg').datagrid('getChanges', 'updated');
				console.info(updated);
				console.info(inserted);
				
				var url = "";
				if (inserted.length > 0) {
					url = "InsertServlet";
				}
				$.ajax({
					type: "POST",
					url: url,
					data: rowData,
					dataType: 'json',
					success: function(r){
						if (r && r.msg == "okey") {
							$('#dg').datagrid('acceptChanges');
							$.messager.show({
								msg: r.msg,
								title: "done",
							});
						}
						else {
							$('#dg').datagrid('rejectChanges');
							$.messager.alert("error", r.msg, "error");
						}
					}
				});
				
			},
			onDblClickRow: function(rowIndex, rowData){
				alert(rowIndex + " " + rowData);
				$('#dg').datagrid('beginEdit', rowIndex);
			},
			onClickRow: function(rowIndex, rowData){
				$('#dg').datagrid('endEdit', rowIndex);
			//		console.info($(rowData)[0].name);
			//		console.info($(rowData).get(0).name);
			},
			onRowContextMenu: function(e, rowIndex, rowData){
				e.preventDefault();
				console.info(e);
				//console.info(e.clientX);
				$(this).datagrid('unselectAll');
				$(this).datagrid('selectRow', rowIndex);
				$('#menu').menu('show', {
					//  left: e.clientX,    
					//  top: e.clientY  
					left: e.pageX,
					top: e.pageY
				});
			}
		});
		$('.datagrid-header div').css('textAlign', 'center');
		
		$('#cc1').combo({
			required: true,
			multiple: true,
			panelWidth: 200,
			panelHeight:200,
			width:220,
			onChange: function(newValue, oldValue){
				console.info("----------");	
				console.info(newValue);	
				console.info(oldValue);	
				console.info("----------");
			},
			validType:'email'
		});
		$('#sp').appendTo($('#cc1').combo('panel'));
		$('#sp input').click(function(){
			var v = $(this).val();
			var s = $(this).next('span').text();
			var abc = $(this).attr('abc');
			console.info(abc);
			$('#cc1').combo('setValue', v).combo('setText', s).combo('hidePanel');
			console.info($('#cc1').combo('getValues'));
		});
		$('.combo-text').click(function(){
			$('#cc1').combo('showPanel');
		});
		
		//$('#combotree').combotree('setValues', [5,6,7]);
		
		$('#ff').form({    
		    url:"FormServlet",    
		    onSubmit: function(){    
		        console.info("form click");
				var isValid = $(this).form('validate');
				if (!isValid){
					$.messager.progress('close');	// 
				}
				return isValid;	//  
		    },    
		    success:function(data){  
			   console.info(data);  
		       $.messager.progress('close');	//  
		    }    
		});    
	
	});
	
	function dosearch(){
			$('#dg').datagrid('load',{
				code: '01',
				name: $("#searchForm").find("[name=name]").val()
			});
		}
		
	dosearch1 = function(){
		//alert("aaa");
	}
	
	menu_append = function(){
		var selectedRow = $('#dg').datagrid('getSelections');
		alert($('#dg').datagrid('getRowIndex',selectedRow[0]));
	}
	menu_edit = function(){
		alert("bbb");
	}
	menu_remove = function(){
		alert("ccc");
	}
	edit_show = function(RowIndex){
		//alert(RowIndex);
		var rows = $('#dg').datagrid('getRows');
		console.info($(rows[RowIndex]).get(0).name);
	}
	
</script>

<div id="menu" class="easyui-menu" style="display:none;width:120px;">
	<div iconCls="icon-add" onclick="menu_append();">add</div>
	<div iconCls="icon-edit" onclick="menu_edit();">update</div>
	<div iconCls="icon-remove" onclick="menu_remove();">delete</div>
</div>

<div id="tt" class="easyui-tabs" fit="true" border="false">   
    <div title="Tab1"  border="false">   
        
		<table class="easyui-datagrid">   
		    <thead>   
		        <tr>   
		            <th data-options="field:'code'">AAA</th>   
		            <th data-options="field:'name'">BBB</th>   
		            <th data-options="field:'price'">CCC</th>   
		        </tr>   
		    </thead>   
		    <tbody>   
		        <tr>   
		            <td>001</td><td>name1</td><td>2323</td>   
		        </tr>   
		        <tr>   
		            <td>002</td><td>name2</td><td>4612</td>   
		        </tr>   
		    </tbody>   
		</table>  

    </div>   
	
    <div title="Tab2" data-options="closable:true"  fit="true" border="false" >   
        <div reion="north" border="false" title="filter" style="heigh:110px">
        	<form id="searchForm">
        		<table class="" style="height:100%">
        			<tr>
        				<th>ID</th>
						<td><input name="name" /></td>
					</tr>
					<tr>
						<th>Time</th>
						<td><input name="createtime" editable="false" class="easyui-datetimebox"/> To <input name="stoptime" editable="false"  class="easyui-datebox"/>
						<a href="javascript:void(0);" class="easyui-linkbutton" onclick="dosearch();" >Query</a>	
						</td>
					</tr>
				</table>
        	</form>
		</div>
		<div reion="center" border="false" style="height:300px;" >
	    	<table id="dg"></table>  
		</div>
		
    </div>   
	
    <div title="Tab3" data-options="iconCls:'icon-reload',closable:true"  border="false">   
        <select id="cc1" ></select>  
		<div  id='sp'>
			<div style="width:200px" >selet a language</div>
			<input  type='radio' name='lang' value='01' abc="aa"/><span>Java@mail.com</span><br/>
			<input  type='radio' name='lang' value='02' abc="bb"/><span>C++</span><br/>
			<input  type='radio' name='lang' value='03'/><span>C#</span><br/>
			<input  type='radio' name='lang' value='04'/><span>PHP</span><br/> 
		</div>
		
		<hr/>
		<select id="ccbox" class="easyui-combobox" name="dept" style="width:200px;">   
		    <option value="aa">aitem1</option>   
		    <option>bitem2</option>   
		    <option>bitem3</option>   
		    <option>ditem4</option>   
		    <option>eitem5</option>   		
		</select>
		<input id="ccbox1" class="easyui-combobox" name="dept"   
	    		data-options="valueField:'id',textField:'text',url:'combobox.json'" />  
		
		<hr/>
		<input id="cc1" class="easyui-combobox" data-options="valueField: 'id',textField: 'text',    
        	url: 'combobox.json',    
        	onSelect: function(rec){    
        	<!-- 	
			 	var url = 'combobox.json?id='+rec.id;    
       	    	$('#cc2').combobox('reload', url);    
			-->
				$('#cc3').combobox('setValues', ['001','002']);
        	}" />   
		<input id="cc2" class="easyui-combobox" data-options="required:true,mode:'remote',url:'TreeServlet',valueField:'id',textField:'text'" />  
		<input id="cc3" class="easyui-combobox" data-options="required:true,valueField:'id',textField:'text'" />  
	
		<hr>
		<select id="combotree" class="easyui-combotree" style="width:200px;"   
        data-options="url:'tree_data.json',required:true, multiple:true " ></select>  
		
		<button value="combotree" onclick="console.info($('#combotree').combotree('getValues'))" >combotree</button>
		<hr/>
		<div id="cc" class="easyui-calendar" style="width:180px;height:180px;"></div> 
		
		<hr/>
		<form id="ff" method="post">   
		    <div>   
		        <label for="name">Name:</label>   
		        <input class="easyui-validatebox" type="text" name="name" data-options="required:true" />   
		    </div>   
		    <div>   
		        <label for="email">Email:</label>   
		        <input class="easyui-validatebox" type="text" name="email" data-options="validType:'email'" />   
		    </div>   
			<input type="button" value="submit" onclick="$('#ff').submit()" />
		</form>  

		<select id="cc" class="easyui-combogrid" name="dept" style="width:250px;"   
	        data-options= "panelWidth:450,    
						required: true,
						delay: 500,
						fitColumns: true,
			            value:'006',    
			            idField:'code',    
			            textField:'name',    
			            url:'combogrid.json',   
						pagination:true, 
			            columns:[[    
			                {field:'code',title:'Code',width:60},    
			                {field:'name',title:'Name',width:100},    
			                {field:'addr',title:'Address',width:120},    
			                {field:'col4',title:'Col41',width:100}    
			            ]]">
		</select> 
		
		<hr/>
		<table id="pg" class="easyui-propertygrid" style="width:300px"   
        data-options="url:'propertygrid.json',
					  showGroup:true,
					  scrollbarSize:0,
					  showHeader:false"></table>  
		
		<input type='button' value="click" onclick="console.info($('#pg').propertygrid('getData'))"/>

	</div>   
	
</div>  

